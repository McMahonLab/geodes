trout_key$Phylum <- gsub("NO CLASSIFICATION MH", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("NO CLASSIFICATION LP", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("None", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", trout_key$Phylum)
trout_key$Phylum <- gsub("unclassified unclassified", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("unclassified Oligohymenophorea", "Ciliophora", trout_key$Phylum)
trout_key$Phylum <- gsub("unclassified Pelagophyceae", "Ochrophyta", trout_key$Phylum)
trout_key$Phylum <- gsub("unclassified", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("Unclassified ", "Unclassified", trout_key$Phylum)
trout_key$Phylum <- gsub("UnclassifiedIsochrysidales", "Haptophyta", trout_key$Phylum)
trout_key <- trout_key[which(trout_key$Phylum != "Unclassified"),]
keep <- match(rownames(mnorm), mendota_key$Gene)
mnorm <- mnorm[which(is.na(keep) == F),]
keep <- match(rownames(snorm), spark_key$Gene)
snorm <- snorm[which(is.na(keep) == F),]
keep <- match(rownames(tnorm), trout_key$Gene)
tnorm <- tnorm[which(is.na(keep) == F),]
# Melt data tables and add designation for phylum and time of daty
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$variable <- gsub(".nonrRNA", "", mnorm$variable)
mnorm$Time <- metadata$Time[match(mnorm$variable, metadata$Sample)]
mnorm$Phylum <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
snorm$Genes <- rownames(snorm)
snorm <- melt(snorm)
snorm$variable <- gsub(".nonrRNA", "", snorm$variable)
snorm$Time <- metadata$Time[match(snorm$variable, metadata$Sample)]
snorm$Phylum <- spark_key$Phylum[match(snorm$Genes, spark_key$Gene)]
tnorm$Genes <- rownames(tnorm)
tnorm <- melt(tnorm)
tnorm$variable <- gsub(".nonrRNA", "", tnorm$variable)
tnorm$Time <- metadata$Time[match(tnorm$variable, metadata$Sample)]
tnorm$Phylum <- trout_key$Phylum[match(tnorm$Genes, trout_key$Gene)]
#Aggregate by time and phylum
agg_mnorm <- aggregate(value ~ Time + Phylum, mnorm, mean)
agg_snorm <- aggregate(value ~ Time + Phylum, snorm, mean)
agg_tnorm <- aggregate(value ~ Time + Phylum, tnorm, mean)
agg_mnorm$Time <- factor(agg_mnorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
agg_snorm$Time <- factor(agg_snorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
agg_tnorm$Time <- factor(agg_tnorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
#Change to fold change
phyla <- unique(agg_mnorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- (subset$value + 1)/ave
subset$value[which(subset$value < 1)] <- 1/subset$value[which(subset$value < 1)] * -1
agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ] <- subset
}
phyla <- unique(agg_snorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_snorm[which(agg_snorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- (subset$value + 1)/ave
subset$value[which(subset$value < 1)] <- 1/subset$value[which(subset$value < 1)] * -1
agg_snorm[which(agg_snorm$Phylum == phyla[i]), ] <- subset
}
phyla <- unique(agg_tnorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_tnorm[which(agg_tnorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- (subset$value + 1)/ave
subset$value[which(subset$value < 1)] <- 1/subset$value[which(subset$value < 1)] * -1
agg_tnorm[which(agg_tnorm$Phylum == phyla[i]), ] <- subset
}
# Pick the most expressed phyla to plot
me_expressed <- c("Chloroflexi", "Heterokonta", "Cyanobacteria", "Bacteroidetes", "Gemmatimonadetes", "Cryptophyta", "Crenarchaeota", "Actinobacteria", "Viruses", "Proteobacteria")
agg_mnorm <- agg_mnorm[which(agg_mnorm$Phylum %in% me_expressed),]
agg_mnorm$Phylum <- factor(agg_mnorm$Phylum, levels = rev(me_expressed))
sp_expressed <- c("Heterokonta", "Cyanobacteria", "TM7", "Armatimonadetes", "Bacteroidetes", "Proteobacteria", "Cryptophyta",  "Haptophyta", "Actinobacteria", "Elusimicrobia")
agg_snorm <- agg_snorm[which(agg_snorm$Phylum %in% sp_expressed),]
agg_snorm$Phylum <- factor(agg_snorm$Phylum, levels = rev(sp_expressed))
tb_expressed <- c("Cyanobacteria", "Armatimonadetes", "Streptophyta", "Cryptophyta", "Verrucomicrobia", "Deinococcus-Thermus", "Bacteroidetes", "Actinobacteria", "Proteobacteria", "Chlorophyta")
agg_tnorm <- agg_tnorm[which(agg_tnorm$Phylum %in% tb_expressed),]
agg_tnorm$Phylum <- factor(agg_tnorm$Phylum, levels = rev(tb_expressed))
ggplot(agg_mnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_snorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_tnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
hist(agg_tnorm$value)
max(agg_snorm$value)
agg_snorm[which(agg_snorm < -6)] <- -6
agg_snorm$value[which(agg_snorm$value < -6)] <- -6
agg_tnorm $value[which(agg_snorm$value < -4)] <- -4
ggplot(agg_snorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_tnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
i = 4
phyla[4]
phyla[3]
i = 3
subset <- agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ]
subset
agg_mnorm <- aggregate(value ~ Time + Phylum, mnorm, mean)
agg_mnorm$Time <- factor(agg_mnorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
subset <- agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ]
subset
ave <- mean(subset$value)
subset$value <- subset$value - ave
subset
maxrange <- max(abs(subset$value))
maxrange
subset$value * (10/maxrange)
agg_mnorm <- aggregate(value ~ Time + Phylum, mnorm, mean)
agg_snorm <- aggregate(value ~ Time + Phylum, snorm, mean)
agg_tnorm <- aggregate(value ~ Time + Phylum, tnorm, mean)
agg_mnorm$Time <- factor(agg_mnorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
agg_snorm$Time <- factor(agg_snorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
agg_tnorm$Time <- factor(agg_tnorm$Time, levels = c("1", "5", "9", "13", "17", "21"))
#Change to fold change
phyla <- unique(agg_mnorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- subset$value - ave
maxrange <- max(abs(subset$value))
subset$value <- subset$value * (10/maxrange)
agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ] <- subset
}
phyla <- unique(agg_tnorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_tnorm[which(agg_tnorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- subset$value - ave
maxrange <- max(abs(subset$value))
subset$value <- subset$value * (10/maxrange)
agg_tnorm[which(agg_tnorm$Phylum == phyla[i]), ] <- subset
}
phyla <- unique(agg_snorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_snorm[which(agg_snorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- subset$value - ave
maxrange <- max(abs(subset$value))
subset$value <- subset$value * (10/maxrange)
agg_snorm[which(agg_snorm$Phylum == phyla[i]), ] <- subset
}
# Pick the most expressed phyla to plot
me_expressed <- c("Chloroflexi", "Heterokonta", "Cyanobacteria", "Bacteroidetes", "Gemmatimonadetes", "Cryptophyta", "Crenarchaeota", "Actinobacteria", "Viruses", "Proteobacteria")
agg_mnorm <- agg_mnorm[which(agg_mnorm$Phylum %in% me_expressed),]
agg_mnorm$Phylum <- factor(agg_mnorm$Phylum, levels = rev(me_expressed))
sp_expressed <- c("Heterokonta", "Cyanobacteria", "TM7", "Armatimonadetes", "Bacteroidetes", "Proteobacteria", "Cryptophyta",  "Haptophyta", "Actinobacteria", "Elusimicrobia")
agg_snorm <- agg_snorm[which(agg_snorm$Phylum %in% sp_expressed),]
agg_snorm$Phylum <- factor(agg_snorm$Phylum, levels = rev(sp_expressed))
tb_expressed <- c("Cyanobacteria", "Armatimonadetes", "Streptophyta", "Cryptophyta", "Verrucomicrobia", "Deinococcus-Thermus", "Bacteroidetes", "Actinobacteria", "Proteobacteria", "Chlorophyta")
agg_tnorm <- agg_tnorm[which(agg_tnorm$Phylum %in% tb_expressed),]
agg_tnorm$Phylum <- factor(agg_tnorm$Phylum, levels = rev(tb_expressed))
ggplot(agg_mnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_snorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_tnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
agg_mnorm$Time <- factor(agg_mnorm$Time, levels = c("5", "9", "13", "17", "21", "1"))
agg_snorm$Time <- factor(agg_snorm$Time, levels = c("5", "9", "13", "17", "21", "1"))
agg_tnorm$Time <- factor(agg_tnorm$Time, levels = c("5", "9", "13", "17", "21", "1"))
ggplot(agg_mnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_snorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_tnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
agg_mnorm <- aggregate(value ~ Time + Phylum, mnorm, mean)
head(agg_mnorm)
unique(agg_mnorm$Phylum)
phyla <- unique(agg_mnorm$Phylum)
for(i in 1:length(phyla)){
subset <- agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ]
ave <- mean(subset$value)
subset$value <- subset$value - ave
maxrange <- max(abs(subset$value))
subset$value <- subset$value * (10/maxrange)
agg_mnorm[which(agg_mnorm$Phylum == phyla[i]), ] <- subset
}
me_expressed <- c("Chloroflexi", "Heterokonta", "Cyanobacteria", "Bacteroidetes", "Gemmatimonadetes", "Cryptophyta", "Crenarchaeaota", "Actinobacteria", "Viruses", "Proteobacteria")
agg_mnorm <- agg_mnorm[which(agg_mnorm$Phylum %in% me_expressed),]
agg_mnorm$Phylum <- factor(agg_mnorm$Phylum, levels = rev(me_expressed))
ggplot(agg_mnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
agg_mnorm$Time <- factor(agg_mnorm$Time, levels = c("5", "9", "13", "17", "21", "1"))
ggplot(agg_mnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_snorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
ggplot(agg_tnorm, aes(x = Time, y = Phylum, fill = value)) + geom_tile() + scale_fill_gradient2(low = "dodgerblue", mid = "white", high = "yellow")
library(ggplot2)
library(cowplot)
library(reshape2)
metadata <- read.csv(file = "C:/Users/Alex/Desktop/geodes/bioinformatics_workflow/R_processing/sample_metadata.csv", header = T)
# Metagenomic data
metaG_reads <- read.table("D:/geodes_data_tables/GEODES_metaG_ID90_2018-03-10.readcounts.txt", row.names = 1, sep = "\t")
colnames(metaG_reads) <- c("GEODES005", "GEODES006", "GEODES057", "GEODES058", "GEODES117", "GEODES118", "GEODES165", "GEODES166", "GEODES167", "GEODES168")
metaG_key <- read.table("D:/geodes_data_tables/GEODES_metaG_genekey_2018-03-12.txt", sep = "\t", quote = "")
colnames(metaG_key) <- c("Gene", "Genome", "Taxonomy", "Product")
lakekey <- c("Sparkling", "Sparkling", "Trout", "Trout", "Mendota", "Mendota", "Sparkling2009", "Sparkling2009", "Sparkling2009", "Sparkling2009")
metaG_reads <- sweep(metaG_reads, 2, colSums(metaG_reads), "/")
metaG_key$Taxonomy <- gsub("Bacteria;", "", metaG_key$Taxonomy)
metaG_key$Taxonomy <- gsub("Eukaryota;", "", metaG_key$Taxonomy)
metaG_key$Phylum <- sapply(strsplit(as.character(metaG_key$Taxonomy),";"), `[`, 1)
metaG_reads$Genes <- rownames(metaG_reads)
spark_metaG <- metaG_reads[,c(1,2, 11)]
trout_metaG <- metaG_reads[,c(3,4, 11)]
mendota_metaG <- metaG_reads[,c(5,6, 11)]
spark2_metaG <- metaG_reads[,c(7,8,9,10, 11)]
spark_metaG <- melt(spark_metaG)
trout_metaG <- melt(trout_metaG)
mendota_metaG <- melt(mendota_metaG)
spark2_metaG <- melt(spark2_metaG)
# Remove unused metaG datasets to sve RAM
rm(metaG_reads)
snorm <- read.csv("D:/geodes_data_tables/Sparkling_ID90_normalized_readcounts.csv", header = T, row.names = 1)
spark_key <- read.csv("D:/geodes_data_tables/Sparkling_ID90_genekey_reclassified_2018-03-03.csv", header = T)
spark_key$Taxonomy <- gsub("Bacteria;", "", spark_key$Taxonomy)
spark_key$Taxonomy <- gsub("Eukaryota;", "", spark_key$Taxonomy)
spark_key$Phylum <- sapply(strsplit(as.character(spark_key$Taxonomy),";"), `[`, 1)
snorm$Genes <- rownames(snorm)
snorm <- melt(snorm)
snorm$variable <- gsub(".nonrRNA", "", snorm$variable)
snorm$Timepoint <- metadata$Timepoint[match(snorm$variable, metadata$Sample)]
snorm$Taxonomy <- spark_key$Phylum[match(snorm$Genes, spark_key$Gene)]
snorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("None", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("unclassified", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Unclassified ", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", snorm$Taxonomy)
snorm$Taxonomy <- gsub("UnclassifiedUnclassified", "Unclassified", snorm$Taxonomy)
snorm$Taxonomy <- gsub("Candidatus Saccharibacteria", "TM7", snorm$Taxonomy)
snorm$Taxonomy <- gsub("NO CLASSIFICATION BASED ON GIVEN PHYLODIST", "Unclassified", snorm$Taxonomy)
#Remove unclassifieds to save space
snorm <- snorm[which(snorm$Taxonomy != "Unclassified" & snorm$Taxonomy != "internal standard"),]
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = snorm, mean)
wide_snorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_snorm) <- wide_snorm$Taxonomy
wide_snorm <- wide_snorm[, 2:dim(wide_snorm)[2]]
wide_snorm <- wide_snorm[which(rowSums(wide_snorm) > 3000),]
spark_phyla <- data.frame(Taxonomy = rownames(wide_snorm), Sums = rowSums(wide_snorm))
spark_phyla
spark_metaG$Phylum <- metaG_key$Phylum[match(spark_metaG$Genes, metaG_key$Gene)]
spark_metaG$Phylum <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified unclassified unclassified", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("NO CLASSIFICATION MH", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("NO CLASSIFICATION LP", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("None", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified unclassified", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified Oligohymenophorea", "Ciliophora", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified Pelagophyceae", "Ochrophyta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("unclassified", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Unclassified ", "Unclassified", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("UnclassifiedIsochrysidales", "Haptophyta", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("TM7", "Candidatus Saccharibacteria", spark_metaG$Phylum)
spark_metaG$Phylum <- gsub("Ignavibacteriae", "Ignavibacteria", spark_metaG$Phylum)
spark_metaG$Phylum[which(is.na(spark_metaG$Phylum))] <- "Unclassified"
spark_metaG_phyla <- aggregate(value ~ Phylum, data = spark_metaG, mean)
spark_metaG_phyla[order(spark_metaG_phyla$value, decreasing = T)]
spark_metaG_phyla[order(spark_metaG_phyla$value, decreasing = T),]
mendota_intersect
spark_phyla[order(spark_phyla$Sums, decreasing = T),]
# Choose the intersection of the top 10 expressed and abundant
keep <- c("Firmicutes", "Heterokonta", "Armatimonadetes", "Haptophtya", "Chlamydiae", "Verrucomicrobia", "Actinobacteria", "Viruses", "Planctomycetes", "Phaeophyceae", "Cyanobacteria", "TM7", "Bacteroidetes", "Proteobacteria", "Cryptophyta")
sparkling_intersect <- sparkling_phyla[which(sparkling_phyla$Taxonomy %in% keep), ]
sparkling_intersect <- sparkling_phyla[which(spark_phyla$Taxonomy %in% keep), ]
sparkling_intersect <- spark_phyla[which(spark_phyla$Taxonomy %in% keep), ]
sparkling_intersect$metaG <- spark_metaG_phyla$value[match(sparkling_intersect$Taxonomy, spark_metaG_phyla$Phylum)]
sparkling_intersect$Taxonomy <- factor(sparkling_intersect$Taxonomy, levels = sparkling_intersect$Taxonomy[order(sparkling_intersect$metaG, decreasing = F)])
sparkling_intersect <- sparkling_intersect[order(sparkling_intersect$metaG, decreasing = F),]
sparkling_intersect
sparkling_intersect$Type <- c("Bacteria", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Viruses", "Bacteria", "Bacteria", "Bacteria", "Algae", "Bacteria", "Bacteria")
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, y = metaG, fill = Type)) + geom_bar(stat = "identity", color = "black") + coord_flip() + scale_y_reverse() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, size = metaG, fill = Type)) + geom_point(color = "black") + coord_flip() + scale_y_reverse() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, y=metaG, size = metaG, fill = Type)) + geom_point(color = "black") + coord_flip() + scale_y_reverse() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
# Metagenomic data
metaG_reads <- read.table("D:/geodes_data_tables/GEODES_metaG_ID90_2018-03-10.readcounts.txt", row.names = 1, sep = "\t")
metaG_reads[1:5, 1:5]
colSums(metaG_reads)[1:5]
268/12517808
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, y=metaG, size = metaG, fill = Type)) + geom_point(color = "black") + coord_flip() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
sparkling_intersect
melt(sparkling_intersect)
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, fill = Type)) + geom_point()
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, y = metaG, color = Type)) + geom_bar(stat = "identity", color = "black") + coord_flip() + scale_y_reverse() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point()
sparkling_intersect$metaG[which(is.na(sparkling_intersect$metaG) == T)] <- 0
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point() + geom_label()
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point() + geom_label(label = Taxonomy)
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point() + geom_label(aes(label = Taxonomy))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point() + geom_label(aes(label = Taxonomy), color = "black")
library(ggrepel)
install.packages("ggrepel")
install.packages("ggrepel")
library(ggrepel)
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point() + geom_label_repel(aes(label = Taxonomy), color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
# Panel A, metagenomes
ggplot(sparkling_intersect, aes(x = Taxonomy, y = metaG, fill = Type)) + geom_bar(stat = "identity", color = "black", size = 2.5) + coord_flip() + scale_y_reverse() + scale_fill_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", force = 2) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + scale_x_log10() + scale_y_log10()
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", point.padding = 10) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", point.padding = 1) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", force = 1) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", force = 10) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), color = "black", force = 20) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + theme_bw(legend.position = NULL) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + theme_bw(legend.position = NA) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + theme_bw() + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))  + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))  + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod"))  + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")  + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + + scale_fill_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + scale_fill_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + scale_fill_manual(values = c("limegreen", "royalblue", "goldenrod"), alpha = 0.3) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + scale_fill_manual(values = c("limegreen", "royalblue", "goldenrod"), alpha = 0.3) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy), force = 5, color = "black") + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, color = "black", size = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, fill = Type), force = 5, color = "black", size = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, color = "black", size = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 10) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
ggplot(sparkling_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Sparkling Lake") + theme(legend.position = "none")
rm(spark_key)
rm(mnorm)
rm(wide_mnorm)
rm(spark_metaG)
rm(spark_metaG_phyla)
rm(spark_phyla)
rm(snorm)
rm(wide_snorm)
# Remove unused metaG datasets to sve RAM
rm(metaG_reads)
mnorm <- read.csv("D:/geodes_data_tables/Mendota_ID90_normalized_readcounts.csv", header = T, row.names = 1)
mendota_key <- read.csv("D:/geodes_data_tables/Mendota_ID90_genekey_reclassified_2018-03-03.csv", header = T)
# How expressed is each phylum?
mendota_key$Taxonomy <- gsub("Bacteria;", "", mendota_key$Taxonomy)
mendota_key$Taxonomy <- gsub("Eukaryota;", "", mendota_key$Taxonomy)
mendota_key$Phylum <- sapply(strsplit(as.character(mendota_key$Taxonomy),";"), `[`, 1)
mnorm$Genes <- rownames(mnorm)
mnorm <- melt(mnorm)
mnorm$variable <- gsub(".nonrRNA", "", mnorm$variable)
mnorm$Timepoint <- metadata$Timepoint[match(mnorm$variable, metadata$Sample)]
mnorm$Taxonomy <- mendota_key$Phylum[match(mnorm$Genes, mendota_key$Gene)]
mnorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("None", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("unclassified", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("Unclassified ", "Unclassified", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", mnorm$Taxonomy)
mnorm$Taxonomy <- gsub("NO CLASSIFICATION BASED ON GIVEN PHYLODIST", "Unclassified", mnorm$Taxonomy)
#Remove unclassifieds to save space
mnorm <- mnorm[which(mnorm$Taxonomy != "Unclassified" & mnorm$Taxonomy != "internal standard"),]
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = mnorm, mean)
wide_mnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_mnorm) <- wide_mnorm$Taxonomy
wide_mnorm <- wide_mnorm[, 2:dim(wide_mnorm)[2]]
wide_mnorm <- wide_mnorm[which(rowSums(wide_mnorm) > 3000),]
mendota_phyla <- data.frame(Taxonomy = rownames(wide_mnorm), Sums = rowSums(wide_mnorm))
mendota_metaG$Phylum <- metaG_key$Phylum[match(mendota_metaG$Genes, metaG_key$Gene)]
mendota_metaG$Phylum <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified unclassified unclassified", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("NO CLASSIFICATION MH", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("NO CLASSIFICATION LP", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("None", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified unclassified", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified Oligohymenophorea", "Ciliophora", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified Pelagophyceae", "Ochrophyta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("unclassified", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Unclassified ", "Unclassified", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("UnclassifiedIsochrysidales", "Haptophyta", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("TM7", "Candidatus Saccharibacteria", mendota_metaG$Phylum)
mendota_metaG$Phylum <- gsub("Ignavibacteriae", "Ignavibacteria", mendota_metaG$Phylum)
mendota_metaG$Phylum[which(is.na(mendota_metaG$Phylum) == T)] <- "Unclassified"
mendota_metaG_phyla <- aggregate(value ~ Phylum, data = mendota_metaG, mean)
# Choose the intersection of the top 10 expressed and abundant
keep <- c("Chloroflexi", "Actinobacteria", "Ignavibacteria", "Planctomycetes", "Crenarchaeaota", "Cyanobacteria", "Gemmatimonadetes", "Bacteroidetes", "Proteobacteria", "Fibrobacteres", "Cryptophyta", "Heterokonta", "Viruses")
mendota_intersect <- mendota_phyla[which(mendota_phyla$Taxonomy %in% keep), ]
mendota_intersect$metaG <- mendota_metaG_phyla$value[match(mendota_intersect$Taxonomy, mendota_metaG_phyla$Phylum)]
mendota_intersect$Taxonomy <- factor(mendota_intersect$Taxonomy, levels = mendota_intersect$Taxonomy[order(mendota_intersect$metaG, decreasing = F)])
mendota_intersect <- mendota_intersect[order(mendota_intersect$metaG, decreasing = F),]
mendota_intersect$Type <- c("Virus", "Algae", "Algae", "Bacteria", "Bacteria", "Bacteria", "Bacteria", "Archaea", "Bacteria", "Bacteria", "Bacteria", "Bacteria")
ggplot(mendota_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Lake Mendota") + theme(legend.position = "none")
ggplot(mendota_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 7.5) + scale_color_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Lake Mendota") + theme(legend.position = "none")
ggplot(mendota_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 7.5) + scale_color_manual(values = c("limegreen", "lavenderblush4", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Lake Mendota") + theme(legend.position = "none")
rm(mendota_key)
rm(mnorm)
rm(wide_mnorm)
rm(mendota_metaG)
rm(mendota_metaG_phyla)
rm(mendota_phyla)
tnorm <- read.csv("D:/geodes_data_tables/Trout_ID90_normalized_readcounts.csv", header = T, row.names = 1)
trout_key <- read.csv("D:/geodes_data_tables/Trout_ID90_genekey_reclassified_2018-03-03.csv", header = T)
trout_key$Taxonomy <- gsub("Bacteria;", "", trout_key$Taxonomy)
trout_key$Taxonomy <- gsub("Eukaryota;", "", trout_key$Taxonomy)
trout_key$Phylum <- sapply(strsplit(as.character(trout_key$Taxonomy),";"), `[`, 1)
tnorm$Genes <- rownames(tnorm)
tnorm <- melt(tnorm)
tnorm$variable <- gsub(".nonrRNA", "", tnorm$variable)
tnorm$Timepoint <- metadata$Timepoint[match(tnorm$variable, metadata$Sample)]
tnorm$Taxonomy <- trout_key$Phylum[match(tnorm$Genes, trout_key$Gene)]
tnorm$Taxonomy <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("NO CLASSIFICATION MH", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("NO CLASSIFICATION LP", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("None", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("NO CLASSIFICATION DUE TO FEW HITS IN PHYLODIST", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified unclassified", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified Oligohymenophorea", "Ciliophora", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified Pelagophyceae", "Ochrophyta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("unclassified", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Unclassified ", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("UnclassifiedIsochrysidales", "Haptophyta", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("UnclassifiedUnclassified", "Unclassified", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("Candidatus Saccharibacteria", "TM7", tnorm$Taxonomy)
tnorm$Taxonomy <- gsub("NO CLASSIFICATION BASED ON GIVEN PHYLODIST", "Unclassified", tnorm$Taxonomy)
#Remove unclassifieds to save space
tnorm <- tnorm[which(tnorm$Taxonomy != "Unclassified" & tnorm$Taxonomy != "internal standard"),]
averaged_tax <- aggregate(value ~ Taxonomy + Timepoint, data = tnorm, mean)
wide_tnorm <- reshape(averaged_tax, idvar = "Taxonomy", timevar = "Timepoint", direction = "wide")
rownames(wide_tnorm) <- wide_tnorm$Taxonomy
wide_tnorm <- wide_tnorm[, 2:dim(wide_tnorm)[2]]
wide_tnorm <- wide_tnorm[which(rowSums(wide_tnorm) > 3000),]
trout_phyla <- data.frame(Taxonomy = rownames(wide_tnorm), Sums = rowSums(wide_tnorm))
trout_metaG$Phylum <- metaG_key$Phylum[match(trout_metaG$Genes, metaG_key$Gene)]
trout_metaG$Phylum <- gsub("Cryptophyta,Cryptophyceae,Pyrenomonadales,Geminigeraceae,Guillardia,theta", "Cryptophyta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Haptophyta,Prymnesiophyceae,Isochrysidales,Noelaerhabdaceae,Emiliania,huxleyi", "Haptophyta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Heterokonta,Coscinodiscophyceae,Thalassiosirales,Thalassiosiraceae,Thalassiosira,pseudonana", "Heterokonta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Heterokonta,Pelagophyceae,Pelagomonadales,Pelagomonadaceae,Aureococcus,anophagefferens", "Heterokonta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Heterokonta,Ochrophyta,Eustigmataphyceae,Eustigmataceae,Nannochloropsis,gaditana", "Heterokonta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Heterokonta,Bacillariophyceae,Naviculales,Phaeodactylaceae,Phaeodactylum,tricornutum", "Heterokonta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified unclassified", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified unclassified unclassified unclassified", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified unclassified unclassified", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("NO CLASSIFICATION MH", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("NO CLASSIFICATION LP", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("None", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified unclassified Perkinsida", "Perkinsozoa", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified unclassified", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified Oligohymenophorea", "Ciliophora", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified Pelagophyceae", "Ochrophyta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("unclassified", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Unclassified ", "Unclassified", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("UnclassifiedIsochrysidales", "Haptophyta", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("TM7", "Candidatus Saccharibacteria", trout_metaG$Phylum)
trout_metaG$Phylum <- gsub("Ignavibacteriae", "Ignavibacteria", trout_metaG$Phylum)
trout_metaG$Phylum[which(is.na(trout_metaG$Phylum))] <- "Unclassified"
trout_metaG_phyla <- aggregate(value ~ Phylum, data = trout_metaG, mean)
trout_metaG_phyla[order(trout_metaG_phyla$value),]
trout_phyla[order(trout_phyla$Sums),]
# Choose the intersection of the top 10 expressed and abundant
keep <- c("Verrucomicrobia", "Armatimonadetes", "Viruses", "Chlorophyta", "Acidobacteria", "Heterokonta", "Streptophyta", "Actinobacteria", "Bacteroidetes", "Cryptophyta", "Cyanobacteria", "Deinococcus-Thermus", "Proteobacteria")
trout_intersect <- trout_phyla[which(trout_phyla$Taxonomy %in% keep), ]
trout_intersect$metaG <- trout_metaG_phyla$value[match(trout_intersect$Taxonomy, trout_metaG_phyla$Phylum)]
trout_intersect$Taxonomy <- factor(trout_intersect$Taxonomy, levels = trout_intersect$Taxonomy[order(trout_intersect$metaG, decreasing = F)])
trout_intersect <- trout_intersect[order(trout_intersect$metaG, decreasing = F),]
trout_intersect
trout_intersect$Type <- c("Bacteria", "Bacteria", "Bacteria", "Algae", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Algae", "Viruses", "Bacteria", "Bacteria")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 5, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 10, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 15, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 15, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
keep <- c("Verrucomicrobia", "Armatimonadetes", "Viruses", "Chlorophyta", "Acidobacteria", "Heterokonta", "Streptophyta", "Actinobacteria", "Bacteroidetes", "Cryptophyta", "Cyanobacteria", "Deinococcus-Thermus")
trout_intersect <- trout_phyla[which(trout_phyla$Taxonomy %in% keep), ]
trout_intersect$metaG <- trout_metaG_phyla$value[match(trout_intersect$Taxonomy, trout_metaG_phyla$Phylum)]
trout_intersect$Taxonomy <- factor(trout_intersect$Taxonomy, levels = trout_intersect$Taxonomy[order(trout_intersect$metaG, decreasing = F)])
trout_intersect <- trout_intersect[order(trout_intersect$metaG, decreasing = F),]
trout_intersect$Type <- c("Bacteria", "Bacteria", "Bacteria", "Algae", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Algae", "Viruses", "Bacteria", "Bacteria")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 15, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
trout_intersect$Type <- c("Bacteria", "Bacteria", "Bacteria", "Algae", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Algae", "Viruses", "Bacteria")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 15, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
trout_intersect
trout_intersect$Type <- c("Bacteria", "Bacteria", "Algae", "Bacteria", "Bacteria", "Algae", "Algae", "Bacteria", "Algae", "Viruses", "Bacteria", "Bacteria")
ggplot(trout_intersect, aes(x = metaG, y = Sums, color = Type)) + geom_point(size = 2.5) + geom_label_repel(aes(label = Taxonomy, color = Type), force = 15, size = 7.5) + scale_color_manual(values = c("limegreen", "royalblue", "goldenrod")) + labs(x = "Proportion of metagenomic reads assigned", y = "Transcripts/L assigned", title = "Trout Bog") + theme(legend.position = "none")
